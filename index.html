<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fast Food Feedback</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1>RamDev Dalwada</h1>
    <div class="contact-info">
      <p>📍 Best Taste in Town</p>
      <p>📧 ritikbhalwala1@gmail.com</p>
      <p>📞 +91 90335 61438</p>
    </div>

    <form id="feedback-form">
      <label>Name:</label>
      <input type="text" name="name" required>

      <label>Email:</label>
      <input type="email" name="email" required>

      <label>Feedback:</label>
      <textarea name="message" required></textarea>

      <label>Rating:</label>
      <div class="stars">
        <input type="radio" id="star5" name="rating" value="5" required><label for="star5">★</label>
        <input type="radio" id="star4" name="rating" value="4"><label for="star4">★</label>
        <input type="radio" id="star3" name="rating" value="3"><label for="star3">★</label>
        <input type="radio" id="star2" name="rating" value="2"><label for="star2">★</label>
        <input type="radio" id="star1" name="rating" value="1"><label for="star1">★</label>
      </div>

      <label>Upload Image:</label>
<input type="file" id="imageUpload" accept="image/*" capture="environment" />



      <button type="submit">Submit Feedback</button>
    </form>

    <div id="avg-rating">
      <h2>⭐ Average Rating: <span id="average">N/A</span></h2>
    </div>
    <div id="review-list"></div>
  </div>

  <!-- ✅ Footer -->
  <footer class="developer-credit">
    <p>© 2025 Ramdev Dalwada | Developed by <span>Fenil</span></p>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAumqMP8xJyz29JIUme0xKqeHqFa89Zgpw",
      authDomain: "fast-food-feedback-ad9d2.firebaseapp.com",
      databaseURL: "https://fast-food-feedback-ad9d2-default-rtdb.firebaseio.com",
      projectId: "fast-food-feedback-ad9d2",
      storageBucket: "fast-food-feedback-ad9d2.appspot.com",
      messagingSenderId: "443979330302",
      appId: "1:443979330302:web:ac16d2bb95d44884a6abaf",
      measurementId: "G-NV965T81WZ"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Main Logic -->
  <script>
    const form = document.getElementById("feedback-form");
    const averageDisplay = document.getElementById("average");
    const reviewList = document.getElementById("review-list");
    const db = firebase.database().ref("feedbacks");
    const storage = firebase.storage().ref("review-images");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const name = form.name.value;
      const email = form.email.value;
      const message = form.message.value;
      const rating = form.rating.value;
      const imageFile = document.getElementById("imageUpload").files[0];

      if (imageFile) {
        const filePath = Date.now() + "_" + imageFile.name;
        const uploadTask = storage.child(filePath).put(imageFile);

        uploadTask.then(snapshot => {
          return snapshot.ref.getDownloadURL();
        }).then(imageUrl => {
          saveFeedback({ name, email, message, rating: parseInt(rating), imageUrl });
        }).catch(error => {
          alert("Image upload failed.");
          console.error(error);
        });

      } else {
        saveFeedback({ name, email, message, rating: parseInt(rating), imageUrl: null });
      }
    });

    function saveFeedback(feedback) {
      feedback.date = new Date().toISOString();
      db.push(feedback);
      form.reset();
      alert("Feedback submitted!");
      setTimeout(loadReviews, 500);
    }

    function loadReviews() {
      db.once("value", snapshot => {
        const data = snapshot.val();
        let total = 0, count = 0;
        reviewList.innerHTML = "";

        for (let key in data) {
          const { name, message, rating, imageUrl } = data[key];
          total += rating;
          count++;

          const div = document.createElement("div");
          div.innerHTML = `
            <p><strong>${name}</strong>: ${message} <br>⭐ ${rating}</p>
            ${imageUrl ? `<img src="${imageUrl}" alt="Review Image" style="max-width:100%;border-radius:8px;margin:10px 0;">` : ""}
            <hr>
          `;
          reviewList.appendChild(div);
        }

        averageDisplay.textContent = count ? (total / count).toFixed(1) + " / 5" : "N/A";
      });
    }

    loadReviews();
  </script>
</body>
</html>
